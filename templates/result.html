<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Advanced Prediction Result</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      border-radius: 1rem;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    .card-header {
      background: linear-gradient(135deg, #4f46e5 0%, #6e45e2 100%);
      border-bottom: none;
      border-top-left-radius: 1rem;
      border-top-right-radius: 1rem;
    }
    #result-panel {
        transition: all 0.5s ease;
    }
    .btn-back {
      font-weight: 600;
      border-radius: 0.5rem;
      transition: all 0.2s ease-in-out;
    }
    .btn-back:hover {
       transform: translateY(-2px);
       box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card">
          <div class="card-header text-white text-center py-3">
            <h2 class="mb-0"><i class="bi bi-clipboard-data-fill me-2"></i>Prediction Result</h2>
          </div>
          <div class="card-body p-4 p-md-5 text-center">
            
            <div id="result-panel" class="alert p-3 my-3">
                <h5 class="alert-heading mb-0" id="result-heading"></h5>
                <h1 id="result-label" class="display-5 fw-bold mb-0"></h1>
            </div>

            <div class="my-4 mx-auto" style="max-width: 300px;">
                <canvas id="probabilityChart"></canvas>
            </div>
            
            <div id="insight-panel" class="alert mt-4" role="alert">
                <h5 class="alert-heading"><i id="insight-icon" class="me-2"></i>Key Insight</h5>
                <p id="insight-text" class="mb-0"></p>
            </div>
            
            <div class="mt-5">
              <a href="/" class="btn btn-outline-secondary btn-back px-4 py-2">
                <i class="bi bi-arrow-left-circle me-2"></i>Predict Again
              </a>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Safely pass data from Jinja2 template to JavaScript
    const predictedLabel = {{ label|tojson }};
    const probabilities = {{ probs|tojson }};

    // --- Dynamic Panels Setup ---
    const resultPanel = document.getElementById('result-panel');
    const resultHeading = document.getElementById('result-heading');
    const resultLabel = document.getElementById('result-label');
    const insightPanel = document.getElementById('insight-panel');
    const insightIcon = document.getElementById('insight-icon');
    const insightText = document.getElementById('insight-text');

    const insights = {
        'Excellent': {
            heading: 'Outstanding Performance!',
            icon: 'bi-trophy-fill',
            colorClass: 'alert-success',
            text: 'This indicates a very strong academic profile. Keep up the great work and aim for consistency.'
        },
        'Good': {
            heading: 'Great Job!',
            icon: 'bi-hand-thumbs-up-fill',
            colorClass: 'alert-primary',
            text: 'Solid performance with great potential. Focus on weaker areas to reach the next level.'
        },
        'Average': {
            heading: 'Solid Foundation',
            icon: 'bi-clipboard-check-fill',
            colorClass: 'alert-warning',
            text: 'A consistent effort is showing. Increasing participation and assignment scores can significantly boost results.'
        },
        'Needs Improvement': {
            heading: 'Area for Growth',
            icon: 'bi-graph-up-arrow',
            colorClass: 'alert-danger',
            text: 'There is an opportunity for improvement. Prioritizing attendance and seeking help can make a big difference.'
        }
    };
    
    // Default insight if label not found
    const selectedInsight = insights[predictedLabel] || insights['Average'];

    resultPanel.classList.add(selectedInsight.colorClass);
    resultHeading.textContent = selectedInsight.heading;
    resultLabel.textContent = predictedLabel;

    insightPanel.classList.add(selectedInsight.colorClass);
    insightIcon.className = selectedInsight.icon + ' me-2';
    insightText.textContent = selectedInsight.text;

    // --- Chart.js Doughnut Chart ---
    const ctx = document.getElementById('probabilityChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(probabilities),
            datasets: [{
                label: 'Confidence Score',
                data: Object.values(probabilities),
                backgroundColor: [
                    'rgba(79, 70, 229, 0.8)',
                    'rgba(129, 140, 248, 0.8)',
                    'rgba(255, 193, 7, 0.8)',
                    'rgba(220, 53, 69, 0.7)',
                    'rgba(156, 163, 175, 0.7)'
                ],
                borderColor: 'rgba(255, 255, 255, 0.8)',
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: {
                            family: "'Poppins', sans-serif"
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                label += context.parsed.toFixed(2) + '%';
                            }
                            return label;
                        }
                    }
                }
            },
            animation: {
                animateScale: true,
                animateRotate: true
            }
        }
    });
  </script>

</body>
</html>